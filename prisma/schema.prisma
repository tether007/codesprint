generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  email         String         @unique
  name          String
  passwordHash  String         @map("password_hash")
  createdAt     DateTime       @default(now()) @map("created_at")
  teamMembers   TeamMember[]
  submissions   Submission[]

  @@map("users")
}

//team is seperated 
model Team {
  id          Int            @id @default(autoincrement())
  name        String         @unique
  teamCode    String         @unique @map("team_code")
  createdAt   DateTime       @default(now()) @map("created_at")
  members     TeamMember[]
  submissions Submission[]

  @@map("teams")
}

//each team member is seperated too
model TeamMember {
  id        Int      @id @default(autoincrement())
  teamId    Int      @map("team_id")
  userId    Int      @map("user_id")
  team      Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@map("team_members")
}

model Challenge {
  id          Int          @id @default(autoincrement())
  title       String
  description String
  points      Int
  flag        String
  submissions Submission[]

  @@map("challenges")
}

model Submission {
  id           Int      @id @default(autoincrement())
  teamId       Int      @map("team_id")
  challengeId  Int      @map("challenge_id")
  submittedBy  Int      @map("submitted_by")
  isCorrect    Boolean  @map("is_correct")
  submittedAt  DateTime @default(now()) @map("submitted_at")
  team         Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  challenge    Challenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [submittedBy], references: [id], onDelete: Cascade)

  @@unique([teamId, challengeId])
  @@map("submissions")
}